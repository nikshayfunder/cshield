<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Just a moment...</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes spin {
      to {
        transform: rotate(360deg)
      }
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1
      }

      50% {
        opacity: .5
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px)
      }

      to {
        opacity: 1;
        transform: translateY(0)
      }
    }

    .spinner {
      animation: spin 1s linear infinite
    }

    .pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite
    }

    .fade-in {
      animation: fadeIn 0.5s ease-out
    }
  </style>
</head>

<body class="min-h-screen bg-neutral-950 text-neutral-100 selection:bg-violet-600/30 selection:text-neutral-50">
  <header class="border-b border-neutral-900/80 bg-neutral-950/60 sticky top-0 z-40">
    <div class="mx-auto max-w-7xl px-4 py-4 flex items-center justify-between">
      <a href="/" class="group flex items-center gap-3">
        <div
          class="h-8 w-8 rounded-lg bg-gradient-to-br from-violet-500 to-fuchsia-600 shadow-lg shadow-violet-800/20 group-hover:scale-105 transition-transform">
        </div>
        <div class="leading-tight">
          <div class="font-semibold -mb-0.5">CShield</div>
          <div class="text-[11px] text-neutral-400">Edge Security Suite</div>
        </div>
      </a>
    </div>
  </header>
  <div class="h-[2px] bg-gradient-to-r from-violet-600 via-fuchsia-500 to-indigo-500 opacity-70"></div>
  <main class="flex-1 flex items-center justify-center px-4 py-20">
    <div class="w-full max-w-2xl fade-in">
      <div class="text-center mb-8">
        <div
          class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-violet-500/20 to-fuchsia-600/20 border border-violet-500/30 mb-6">
          <svg class="spinner w-8 h-8 text-violet-400" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
            </path>
          </svg>
        </div>
        <h1 class="text-3xl font-semibold text-neutral-50 mb-3">Checking your browser...</h1>
        <p class="text-base text-neutral-300 mb-2" id="siteHost">This process is automatic.</p>
        <p class="text-sm text-neutral-400">Your browser will redirect to your requested content shortly.</p>
      </div>

      <div class="rounded-xl border border-neutral-800 bg-neutral-900/40 p-8 shadow-2xl">
        <div class="space-y-4">
          <div class="flex items-center gap-3">
            <div class="flex-shrink-0 w-6 h-6 rounded-full bg-violet-500/20 flex items-center justify-center">
              <div class="w-2 h-2 rounded-full bg-violet-400 pulse"></div>
            </div>
            <div class="flex-1">
              <div class="text-sm font-medium text-neutral-200">Verifying browser integrity</div>
              <div class="text-xs text-neutral-500 mt-0.5" id="status">Initializing security checks...</div>
            </div>
          </div>
          <div class="h-1 bg-neutral-800 rounded-full overflow-hidden">
            <div id="progress"
              class="h-full bg-gradient-to-r from-violet-500 to-fuchsia-500 transition-all duration-500"
              style="width: 0%"></div>
          </div>
        </div>

        <div class="mt-6 p-4 rounded-lg bg-neutral-950/60 border border-neutral-800">
          <div class="text-xs text-neutral-400 leading-relaxed">
            <p class="mb-2"><strong class="text-neutral-300">Why am I seeing this page?</strong></p>
            <p>Requests from malicious bots can pose as legitimate traffic. CShield is analyzing your browser to ensure
              you're a real visitor and not an automated bot.</p>
          </div>
        </div>
      </div>

      <div class="mt-8 text-center text-xs text-neutral-500">
        <div class="mb-2">Request ID: <span id="reqId" class="font-mono text-neutral-400">â€”</span></div>
        <div>Performance & security by <span class="text-violet-400 font-medium">CShield</span></div>
      </div>
    </div>
  </main>
  <div
    class="fixed inset-x-0 bottom-0 h-[1px] bg-gradient-to-r from-fuchsia-500 via-violet-600 to-indigo-500 opacity-70">
  </div>
  <script>
    let moves = 0, jitter = 0, last = null, focusEvents = 0, challenge = null, fpHash = "", devID = "", sessID = "";
    const sEl = document.getElementById("status"), progressBar = document.getElementById("progress");
    const siteHostEl = document.getElementById("siteHost"), reqIdEl = document.getElementById("reqId");

    function b64u(buf) { let b = window.btoa(String.fromCharCode.apply(null, new Uint8Array(buf))); return b.replace(/\+/g, "-").replace(/\//g, "_").replace(/=+$/, "") }
    async function sha256(s) { const enc = new TextEncoder().encode(s); const d = await crypto.subtle.digest("SHA-256", enc); return b64u(d) }
    function qs(k) { return new URLSearchParams(location.search).get(k) || "" }
    function now() { return Math.floor(Date.now() / 1000) }
    function jitterInc(x, y) { if (!last) { last = [x, y]; return } const dx = x - last[0], dy = y - last[1]; jitter += Math.abs(dx) + Math.abs(dy); last = [x, y] }

    addEventListener("mousemove", e => { moves++; jitterInc(e.screenX, e.screenY) });
    addEventListener("focus", () => { focusEvents++ });
    addEventListener("blur", () => { focusEvents++ });

    function setHost() {
      let h = "";
      try {
        const r = qs("r");
        if (r) {
          try {
            const u = new URL(r, location.origin);
            h = u.host || u.hostname || ""
          } catch (_) { }
        }
      } catch (_) { }
      if (!h) { h = location.host || location.hostname || "" }
      if (!h) { h = "this site" }
      if (siteHostEl) siteHostEl.textContent = h;
    }

    function setReqId() {
      try {
        const r = crypto.randomUUID ? crypto.randomUUID() : Math.random().toString(16).slice(2) + Math.random().toString(16).slice(2);
        if (reqIdEl) reqIdEl.textContent = r
      } catch (_) { }
    }

    function updateProgress(percent, msg) {
      if (progressBar) progressBar.style.width = percent + "%";
      if (sEl) sEl.textContent = msg;
    }

    async function fingerprint() {
      try {
        const n = navigator, s = screen;
        const data = {
          ua: n.userAgent || "",
          lang: n.language || "",
          pl: n.platform || "",
          cd: s.colorDepth || 0,
          dm: n.deviceMemory || 0,
          hc: n.hardwareConcurrency || 0,
          sw: s.width || 0,
          sh: s.height || 0,
          px: window.devicePixelRatio || 1,
          tz: (Intl.DateTimeFormat().resolvedOptions().timeZone || ""),
          touch: ('ontouchstart' in window),
          fonts: (navigator.languages || []).join(","),
          vendor: n.vendor || ""
        };
        if (!window.crypto || !crypto.subtle || typeof TextEncoder === "undefined") {
          const base = (n.userAgent || "") + "|" + (n.language || "") + "|" + (s.width || 0) + "x" + (s.height || 0);
          fpHash = base;
          devID = Math.random().toString(16).slice(2) + Math.random().toString(16).slice(2);
          return
        }
        devID = (await sha256(JSON.stringify(data) + navigator.cookieEnabled + Math.random().toString().slice(2))).slice(0, 32);
        fpHash = await sha256(JSON.stringify(data));
      } catch (e) {
        const n = navigator, s = screen;
        fpHash = (n.userAgent || "") + "|" + (n.language || "") + "|" + (s.width || 0) + "x" + (s.height || 0);
        devID = Math.random().toString(16).slice(2) + Math.random().toString(16).slice(2);
      }
    }

    async function getChallenge() {
      const r = qs("r");
      try {
        const res = await fetch("/v1/api/captcha/new", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ fp: fpHash, devID, ref: r })
        });
        if (!res.ok) {
          updateProgress(0, "Service unavailable");
          challenge = null;
          return
        }
        const j = await res.json();
        challenge = j || null;
        if (challenge && j.sessID) { sessID = j.sessID }
      } catch (e) {
        updateProgress(0, "Service unavailable");
        challenge = null
      }
    }

    function currentSignals() {
      return { moves, jitter, focus: focusEvents, ts: now(), clickTs: now() }
    }

    async function autoVerify() {
      try {
        updateProgress(20, "Analyzing browser fingerprint...");
        await new Promise(r => setTimeout(r, 400));

        updateProgress(40, "Collecting behavioral signals...");
        await new Promise(r => setTimeout(r, 400));

        if (!challenge) {
          await getChallenge();
          if (!challenge) {
            updateProgress(0, "Service unavailable, please refresh the page.");
            return
          }
        }

        updateProgress(60, "Verifying request authenticity...");
        await new Promise(r => setTimeout(r, 400));
        await new Promise(r => setTimeout(r, 300));
        
        const r = qs("r");
        const payload = {
          challengeID: challenge.id,
          fp: fpHash,
          devID,
          signals: currentSignals(),
          ref: r
        };

        updateProgress(80, "Completing verification...");

        const res = await fetch("/v1/api/captcha/verify", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          updateProgress(0, "Verification failed. Please refresh the page.");
          return
        }

        const j = await res.json();

        if (j.ok && j.redirect) {
          updateProgress(100, "Success! Redirecting...");
          await new Promise(r => setTimeout(r, 300));
          location.replace(j.redirect);
          return
        }

        updateProgress(0, "Verification incomplete. Please refresh the page.");
      } catch (e) {
        updateProgress(0, "Unexpected error. Please refresh the page.");
      }
    }

    (async () => {
      try {
        setHost();
        setReqId();
        updateProgress(10, "Initializing...");
        await fingerprint();
        await new Promise(r => setTimeout(r, 500));
        await autoVerify();
      } catch (e) {
        updateProgress(0, "Initialization error. Please refresh the page.");
      }
    })();
  </script>
</body>

</html>