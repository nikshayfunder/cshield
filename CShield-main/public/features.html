<!doctype html>
<html lang="en" class="dark">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CShield â€¢ Features</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<style>
:root{--bg:#09090b;--primary:#6366f1;--accent:#a855f7}
html,body{height:100%;scroll-behavior:smooth}
body{font-family:'Inter',system-ui,-apple-system,BlinkMacSystemFont,sans-serif;background-color:var(--bg);color:#e4e4e7;-webkit-font-smoothing:antialiased}
.glass{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.05);backdrop-filter:blur(10px);transition:transform .2s,background .2s;overflow:hidden;position:relative}
.glass:hover{background:rgba(255,255,255,0.05);transform:translateY(-1px);box-shadow:0 10px 40px -10px rgba(0,0,0,0.5)}
.glass::after{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background:radial-gradient(800px circle at var(--mouse-x,0) var(--mouse-y,0),rgba(255,255,255,0.06),transparent 40%);opacity:0;transition:opacity .3s;pointer-events:none}
.glass:hover::after{opacity:1}
.bgfx{position:fixed;inset:0;background:
radial-gradient(40% 30% at 15% 10%,rgba(139,92,246,.10),transparent 60%),
radial-gradient(30% 30% at 85% 0,rgba(59,130,246,.08),transparent 60%),
radial-gradient(50% 40% at 50% 100%,rgba(16,185,129,.06),transparent 60%);filter:blur(44px);pointer-events:none}
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.1);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,0.2)}
</style>
</head>
<body class="bg-[var(--bg)] text-zinc-200 antialiased min-h-screen overflow-x-hidden">
<div class="bgfx"></div>

<div class="fixed inset-0 z-[-1] pointer-events-none overflow-hidden">
  <div class="absolute top-[-10%] left-[-10%] w-[600px] h-[600px] bg-violet-500/10 rounded-full blur-[120px]"></div>
  <div class="absolute bottom-[-10%] right-[-10%] w-[600px] h-[600px] bg-fuchsia-500/10 rounded-full blur-[120px]"></div>
</div>

<div class="flex flex-col lg:flex-row min-h-screen">
  <aside class="lg:w-72 border-b lg:border-b-0 lg:border-r border-neutral-800/80 bg-black/40 backdrop-blur-xl flex lg:flex-col justify-between p-5 z-40 sticky top-0 lg:h-screen">
    <div class="flex flex-col gap-8">
      <div class="flex items-center gap-3 px-2">
        <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-violet-500 to-fuchsia-600 flex items-center justify-center shadow-lg shadow-violet-500/30">
          <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
          </svg>
        </div>
        <div>
          <span class="font-bold text-zinc-100 tracking-tight block leading-none">CShield</span>
          <span class="text-[10px] uppercase tracking-[0.2em] text-zinc-500 font-medium">Edge Security</span>
        </div>
      </div>
      <nav class="flex lg:flex-col gap-1 overflow-x-auto lg:overflow-visible no-scrollbar text-sm">
        <a href="/dashboard" class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-lg font-medium text-zinc-400 hover:text-zinc-100 hover:bg-white/5 transition">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
            <path d="M10 3.5L3 9v11h6v-7h6v7h6V9z"/>
          </svg>
          <span>Overview</span>
        </a>
        <a href="/analytics" class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-lg font-medium text-zinc-400 hover:text-zinc-100 hover:bg-white/5 transition">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
            <path d="M4 5h16v2H4V5zm0 4h10v2H4v-2zm0 4h7v2H4v-2zm9 0h7v2h-7v-2z"/>
          </svg>
          <span>Traffic</span>
        </a>
        <a href="/features" class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-lg font-medium bg-white/5 text-white shadow-[0_0_0_1px_rgba(255,255,255,0.05)]">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
            <path d="M4 6h16v2H4V6zm0 4h10v2H4v-2zm0 4h7v2H4v-2zm9 0h7v2h-7v-2z"/>
          </svg>
          <span>Features</span>
        </a>
        <a href="/proxies" class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-lg font-medium text-zinc-400 hover:text-zinc-100 hover:bg-white/5 transition">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
            <path d="M3 5h18v4H3V5zm0 5h18v9H3v-9zm2 2v5h14v-5H5z"/>
          </svg>
          <span>Proxies</span>
        </a>
        <a href="/settings" class="nav-link flex items-center gap-3 px-3 py-2.5 rounded-lg font-medium text-zinc-400 hover:text-zinc-100 hover:bg-white/5 transition">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 8a4 4 0 1 0 .001 8.001A4 4 0 0 0 12 8zm8.94 4a7.96 7.96 0 0 0-.16-1.61l2.07-1.62l-2-3.46l-2.49 1a8.24 8.24 0 0 0-2.79-1.62l-.42-2.65H9.85l-.42 2.65a8.24 8.24 0 0 0-2.79 1.62l-2.49-1l-2 3.46l-2.07-1.62c.1-.52.16-1.06.16-1.61z"/>
          </svg>
          <span>Settings</span>
        </a>
      </nav>
    </div>
  </aside>

  <main class="flex-1 p-4 lg:p-8 w-full max-w-[1920px] mx-auto space-y-6">
    <header class="flex flex-col md:flex-row md:items-center justify-between gap-4 pb-2">
      <div>
        <h1 class="text-2xl font-semibold text-white tracking-tight">Feature Toggles</h1>
        <p class="text-sm text-zinc-500 mt-1">Global toggles for core. Per-proxy overrides live on the Proxies page.</p>
      </div>
    </header>

    <section class="glass rounded-2xl p-6">
      <div class="flex items-center justify-between mb-3">
        <div class="text-sm font-semibold text-zinc-200">Feature Toggles</div>
        <button id="saveFeatures" class="rounded-md bg-violet-600 hover:bg-violet-500 px-3 py-1.5 text-xs font-medium">Save</button>
      </div>
      <div class="text-xs text-zinc-500 mb-3">Toggle core modules like analytics, WAF, CVAC, captcha, and more.</div>
      <div id="features" class="grid grid-cols-1 md:grid-cols-2 gap-3 max-h-[60vh] overflow-auto pr-1"></div>
      <div id="featuresMsg" class="text-xs text-zinc-500 mt-3"></div>
    </section>
  </main>
</div>

<script>
const featuresDiv=document.getElementById("features");
const featuresMsg=document.getElementById("featuresMsg");
let featuresState=null;

function el(tag,cls){const e=document.createElement(tag);if(cls)e.className=cls;return e}

async function loadFeatures(){
  featuresDiv.innerHTML="";
  featuresMsg.textContent="Loading...";
  try{
    const r=await fetch("/v1/api/configs/read?path=features.json");
    if(!r.ok){featuresMsg.textContent="Failed to load features";return}
    const j=await r.json();
    const cfg=JSON.parse(j.content||"{}");
    featuresState=cfg;
    featuresDiv.innerHTML="";
    Object.entries(cfg).forEach(([k,v])=>{
      if(typeof v!=="boolean") return;
      if(k==="maintenance_enabled"||k==="maintenance") return;
      const row=el("label","flex items-center justify-between rounded-lg border border-neutral-800 bg-neutral-950/40 p-3");
      const left=el("div");
      const name=el("div","font-medium text-sm text-zinc-100");
      name.textContent=k;
      const hint=el("div","text-xs text-zinc-500");
      hint.textContent=v?"Enabled":"Disabled";
      left.appendChild(name);
      left.appendChild(hint);
      const toggle=el("input");
      toggle.type="checkbox";
      toggle.checked=!!v;
      toggle.className="w-4 h-4 accent-violet-600";
      toggle.addEventListener("change",()=>{
        featuresState[k]=toggle.checked;
        hint.textContent=toggle.checked?"Enabled":"Disabled";
      });
      row.appendChild(left);
      row.appendChild(toggle);
      featuresDiv.appendChild(row);
    });
    featuresMsg.textContent="";
  }catch(_){
    featuresMsg.textContent="Failed to load features";
  }
}

async function saveFeatures(){
  if(!featuresState){featuresMsg.textContent="Nothing to save";return}
  featuresMsg.textContent="Saving...";
  try{
    const body={path:"features.json",content:JSON.stringify(featuresState)};
    const r=await fetch("/v1/api/configs/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(body)});
    featuresMsg.textContent=r.ok?"Saved":"Failed to save";
  }catch(_){
    featuresMsg.textContent="Failed to save";
  }
}

document.getElementById("saveFeatures").addEventListener("click",saveFeatures);
;(async()=>{await loadFeatures();})();
</script>
</body>
</html>