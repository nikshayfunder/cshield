<!doctype html>
<html lang="en" class="dark">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CShield - Login</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<style>
:root{--bg:#000000;--primary:#6366f1;--accent:#a855f7}
body{font-family:'Inter',sans-serif;background-color:var(--bg);color:#e4e4e7;-webkit-font-smoothing:antialiased}
.glass{background:rgba(20,20,20,0.4);border:1px solid rgba(255,255,255,0.08);backdrop-filter:blur(12px);box-shadow:0 25px 50px -12px rgba(0,0,0,0.5)}
@keyframes floatUp{0%{transform:translateY(10px);opacity:0}100%{transform:translateY(0);opacity:1}}
.animate-float{animation:floatUp 0.6s cubic-bezier(0.16,1,0.3,1) both}
.bgfx{position:fixed;inset:0;background:radial-gradient(circle at 50% 0%,rgba(99,102,241,0.15),transparent 50%);pointer-events:none}
</style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 bg-black overflow-hidden relative">
<div class="bgfx"></div>

<div class="w-full max-w-md animate-float">
  <div class="text-center mb-8">
    <div class="inline-flex items-center justify-center w-12 h-12 rounded-xl bg-gradient-to-br from-indigo-500 to-violet-600 shadow-lg shadow-indigo-500/30 mb-4">
      <svg class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
      </svg>
    </div>
    <h1 class="text-2xl font-bold text-white tracking-tight">Welcome Back</h1>
    <p class="text-sm text-zinc-500 mt-2">Sign in to manage your edge security.</p>
  </div>

  <div class="glass rounded-2xl p-8">
    <form id="loginForm" class="space-y-5">
      <div>
        <label class="block text-xs font-medium text-zinc-400 mb-1.5 uppercase tracking-wide">Username</label>
        <input type="text" id="username" class="w-full bg-black/40 border border-white/10 rounded-lg px-4 py-2.5 text-sm text-white placeholder-zinc-600 focus:outline-none focus:border-indigo-500/50 focus:ring-1 focus:ring-indigo-500/50 transition-all" placeholder="Enter username" required>
      </div>
      <div>
        <label class="block text-xs font-medium text-zinc-400 mb-1.5 uppercase tracking-wide">Password</label>
        <input type="password" id="password" class="w-full bg-black/40 border border-white/10 rounded-lg px-4 py-2.5 text-sm text-white placeholder-zinc-600 focus:outline-none focus:border-indigo-500/50 focus:ring-1 focus:ring-indigo-500/50 transition-all" placeholder="••••••••" required>
      </div>
      <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-medium py-2.5 rounded-lg transition-colors shadow-lg shadow-indigo-900/20">
        Sign In
      </button>
    </form>
    <div id="msg" class="mt-4 text-center text-xs text-rose-400 min-h-[1.25rem]"></div>
  </div>
  
  <p class="text-center text-xs text-zinc-600 mt-8">
    &copy; CShield Edge Security
  </p>
</div>

<script>
const form = document.getElementById('loginForm');
const msg = document.getElementById('msg');

(async () => {
  try {
    const r = await fetch('/v1/api/setup_status');
    if(r.ok) {
      const j = await r.json();
      if(!j.setup) {
        window.location.href = '/register.html';
      }
    }
  } catch(_) {}
})();

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const u = document.getElementById('username').value;
  const p = document.getElementById('password').value;
  msg.textContent = 'Authenticating...';
  msg.className = 'mt-4 text-center text-xs text-zinc-400 min-h-[1.25rem]';
  
  try {
    const res = await fetch('/v1/api/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username: u, password: p })
    });
    const data = await res.json();
    if (res.ok && data.ok) {
      msg.textContent = 'Success! Redirecting...';
      msg.className = 'mt-4 text-center text-xs text-emerald-400 min-h-[1.25rem]';
      setTimeout(() => window.location.href = '/dashboard', 800);
    } else {
      msg.textContent = data.error || 'Invalid credentials';
      msg.className = 'mt-4 text-center text-xs text-rose-400 min-h-[1.25rem]';
    }
  } catch (err) {
    msg.textContent = 'Connection failed';
    msg.className = 'mt-4 text-center text-xs text-rose-400 min-h-[1.25rem]';
  }
});
</script>
</body>
</html>
